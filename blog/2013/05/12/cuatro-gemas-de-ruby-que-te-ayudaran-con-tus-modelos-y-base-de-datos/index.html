<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang=en-us><![endif]--> <!--[if IE 7]><html class="no-js lt-ie10 lt-ie9 lt-ie8" lang=en-us><![endif]--> <!--[if IE 8]><html class="no-js lt-ie10 lt-ie9" lang=en-us><![endif]--> <!--[if IE 9]><html class="no-js lt-ie10 lt-ie9" lang=en-us><![endif]--> <!--[if lt IE 10]><html class="no-js lt-ie10" lang=en-us><![endif]--> <!--[if !IE]>><![endif]--> <html class=no-js lang=en> <head> <title>Cuatro gemas de Ruby que te ayudarán con tus modelos y base de datos. - Code, Love & Boards</title> <meta charset=utf-8 content='text/html' http-equiv=content-type> <meta content='ie=edge,chrome=1' http-equiv=x-ua-compatible> <meta content='A blog about coding web apps, loving life and board sports by Ricardo García Vega' name=description> <meta content='Ricardo García Vega - http://twitter.com/bigardone' name=author> <meta content='ruby, rails, gems, data base' name=keywords> <meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name=viewport> <link href='//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css' rel=stylesheet> <link href="//fonts.googleapis.com/css?family=Montserrat:400,700|Lora:400,700" media=screen rel=stylesheet /> <link href="../../../../../stylesheets/blog-82c14d7c.css" media=all rel=stylesheet /> <link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css' rel=stylesheet> <script src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js'></script> <script src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/elixir.min.js'></script> <script src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/elm.min.js'></script> <link href='/images/apple-touch-icon-57x57-6e598dc4.png' rel=apple-touch-icon sizes=57x57> <link href='/images/apple-touch-icon-114x114-5be964ba.png' rel=apple-touch-icon sizes=114x114> <link href='/images/apple-touch-icon-72x72-70084a85.png' rel=apple-touch-icon sizes=72x72> <link href='/images/apple-touch-icon-144x144-1dbb56c1.png' rel=apple-touch-icon sizes=144x144> <link href='/images/apple-touch-icon-60x60-d05a5ea9.png' rel=apple-touch-icon sizes=60x60> <link href='/images/apple-touch-icon-120x120-5dafce59.png' rel=apple-touch-icon sizes=120x120> <link href='/images/apple-touch-icon-76x76-b2c0d784.png' rel=apple-touch-icon sizes=76x76> <link href='/images/apple-touch-icon-152x152-45595360.png' rel=apple-touch-icon sizes=152x152> <link href='/images/favicon-160x160-944ce76e.png' rel=icon sizes=160x160 type='image/png'> <link href='/images/favicon-96x96-b7e4e089.png' rel=icon sizes=96x96 type='image/png'> <link href='/images/favicon-32x32-b7f34a79.png' rel=icon sizes=32x32 type='image/png'> <link href='/images/favicon-16x16-2712c528.png' rel=icon sizes=16x16 type='image/png'> <meta content='#9f00a7' name=msapplication-TileColor> <meta content='/images/mstile-144x144-028d4c4c.png' name=msapplication-TileImage> <script>
  var _StatHat = _StatHat || [];
  _StatHat.push(['_setUser', 'NzIzMCDaNaL5bvEP1HQkMYwfYsQe']);
  (function() {
          var sh = document.createElement('script'); sh.type = 'text/javascript';
          sh.async = true;
          sh.src = '//www.stathat.com/javascripts/api.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(sh, s);
  })();
</script> <link href='//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css' rel=stylesheet> <script src='//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js'></script> <script>
  window.addEventListener("load", function(){
  window.cookieconsent.initialise({
    "palette": {
      "popup": {
        "background": "#252e39"
      },
      "button": {
        "background": "#217dbb"
      }
    },
    "theme": "classic",
    "position": "bottom-right"
  })});
</script> </head> <body class=blog> <header id=main_header> <div class=main-logo> <a href="/"><img src="../../../../../images/logo-cd52bd68.png"/> </a> </div> <div class=container> <section class=center> <h1>Cuatro gemas de Ruby que te ayudarán con tus modelos y base de datos.</h1> <h3></h3> <div class=meta-data> <hr> posted May 12, 2013 on <a class=tag href="/blog/tags/ruby.html">ruby</a> <a class=tag href="/blog/tags/rails.html">rails</a> <a class=tag href="/blog/tags/gems.html">gems</a> <a class=tag href="/blog/tags/data-base.html">data base</a> </div> </section> </div> </header> <section id=main_content> <div class=container> <section> <article> <p>Últimamente he estado usando estas gemas para ayudarme a tener una mejor visión global de la estructura de los datos en los proyectos nuevos en los que estoy participando, o para ayudarme a optimizar las base de datos y las consultas con las que las aplicaciones acceden a estos.</p> <h3>Annotate (aka AnnotateModels)</h3> <p><a href="https://github.com/ctran/annotate_models" target=_blank>Esta gema</a> hace una cosa muy sencilla, pero muy útil. Crea una serie de anotaciones en tus modelos, tests, fixtures y factorias acerca del esquema de la tabla que usan.</p> <pre><code class="ruby"># == Schema Info
#
# Table name: line_items
#
#  id                  :integer(11)    not null, primary key
#  quantity            :integer(11)    not null
#  product_id          :integer(11)    not null
#  unit_price          :float
#  order_id            :integer(11)
#

 class LineItem &lt; ActiveRecord::Base
   belongs_to :product
  . . .
</code></pre> <p>Para instalarla solo tenemos que añadirla a nuestro <code>Gemfile</code>:</p> <pre><code>gem &#39;annotate&#39;
</code></pre> <p>Una vez hecho esto, para crear las anotaciones, desde el directorio raiz de nuestra aplicación:</p> <pre><code>$ annotate
</code></pre> <p>Esta es la manera más básica de anotar todo, y <strong>Annotate</strong> permite una gran flexibilidad en cuanto a qué anotar y cómo, que podemos encontrar en su <a href="https://github.com/ctran/annotate_models" target=_blank>página de GitHub</a>.</p> <h3>lol_dba</h3> <p>¿Necesitas añadir índices a tu tablas? Con <a href="https://github.com/plentz/lol_dba" target=_blank>lol_dba</a> es muy sencillo, ya que escanea tus modelos para mostrarte las columnas que probablemente deberías indexar. Y no sólo eso, ya que además te puede generar una migración para crear automáticamente esos índices. Para instlarlar, la añadimos al <code>Gemfile</code>:</p> <pre><code>gem &quot;lol_dba&quot;
</code></pre> <p>Una vez hecho ejecutado el consiguiente <code>bundle install</code>, podemos hacer que nos muestre por consola las columnas que podrían necesitar ser indexadas:</p> <pre><code>$ lol_dba db:find_indexes
</code></pre> <p>Y también podemos hacer que genere para nosotros la migración para añadir esos índeces:</p> <pre><code>$ rake db:migrate_sql
</code></pre> <h3>Bullet</h3> <p>En un <a href="/blog/2013/02/14/dos-maneras-de-tener-siempre-a-mano-toda-la-informacion-de-tu-aplicacion-rails-en-desarrollo">post anterior</a> vimos un par de gemas con las que poder ver información sobre lo que ocurre en nuestra aplicación mientras la desarrollamos. Una de esa información que nos porporcionan son las consultas que se realizan contra la base de datos. Cuando el número se dispara suele ser debido al uso de consultas infecientes, obligando a realizar más de las debidas para cargar colecciones y otras relaciones dependientes.</p> <p>¿Cómo podemos solucionar esto? <a href="https://github.com/flyerhzm/bullet" target=_blank>Bullet</a> nos lo pone muy fácil, ya que detecta todas esas ineficiencias en nuestro código y, lo que es mejor, nos aconseja sobre como solucionarlas. Para instalarla la añadimos a nuestro <code>Gemfile</code>:</p> <pre><code>gem &quot;bullet&quot;, :group =&gt; &quot;development&quot;
</code></pre> <p>Luego tendremos que agregar a nuestro fichero de entorno de desarrollo <code>config/environments/development.rb</code> su configuración:</p> <pre><code class="ruby">config.after_initialize do
  Bullet.enable = true
  Bullet.alert = true
  Bullet.bullet_logger = true
  Bullet.console = true
  Bullet.growl = true
  Bullet.xmpp = { :account  =&gt; &#39;bullets_account@jabber.org&#39;,
                  :password =&gt; &#39;bullets_password_for_jabber&#39;,
                  :receiver =&gt; &#39;your_account@jabber.org&#39;,
                  :show_online_status =&gt; true }
  Bullet.rails_logger = true
  Bullet.airbrake = true
end
</code></pre> <p>Con estas opciones podremos configurar la manera en la que nos va a notificar sobre las consultas que deberíamos cambiar. Una vez hecho todo esto, empezaremos a recibir su feedback, que tendrá el siguiente formato:</p> <pre><code>2009-08-25 20:40:17[INFO] N+1 Query: PATH_INFO: /posts;    model: Post =&gt; associations: [comments]·
Add to your finder: :include =&gt; [:comments]
2009-08-25 20:40:17[INFO] N+1 Query: method call stack:·
/Users/richard/Downloads/test/app/views/posts/index.html.erb:11:in `_run_erb_app47views47posts47index46html46erb&#39;
/Users/richard/Downloads/test/app/views/posts/index.html.erb:8:in `each&#39;
/Users/richard/Downloads/test/app/views/posts/index.html.erb:8:in `_run_erb_app47views47posts47index46html46erb&#39;
/Users/richard/Downloads/test/app/controllers/posts_controller.rb:7:in `index&#39;
</code></pre> <p>Sólo nos queda seguir sus instrucciones para ir viendo como el número de consultas van disminuyendo llegando aun número más óptimo.</p> <h3>RailRoady</h3> <p><a href="https://github.com/preston/railroady" target=_blank>Otra gema</a> muy útil si necesitamos tener una visión global de nuestros modelos y controladores, ya que nos genera diagramas UML que nos exporta a ficheros <code>.svg</code> donde podremos ver como se relacionan todas las entidades. Para poder funcionar, necesitará que previamente tengamos instalada <a href="//www.graphviz.org/">Graphviz</a>, la cual la podemos instalar de la siguientes maneras:</p> <pre><code># Usuarios Mac
$ brew install graphviz

# Usuarios Ubuntu
$ sudo apt-get install graphviz
</code></pre> <p>Una vez instalada esta dependencia, añadimos la gema al <code>Gemfile</code>:</p> <pre><code>group :development, :test do
    gem &#39;railroady&#39;
end
</code></pre> <p>Y una vez hecho el <code>bundle install</code>, podremos generar los diagramas con:</p> <pre><code>$ rake diagram:all
</code></pre> <p>Esto nos creará 4 ficheros <code>.svg</code> en la carpeta <code>doc/</code> de nuestro proyecto. Para más información y opciones de configuración visitad su página de <a href="https://github.com/preston/railroady" target=_blank>GitHub</a>.</p> <p>Espero que estas cuatro gemas os ayuden tanto como me ayudan a mi.</p> <p>Code, Love &amp; Boards!</p> <div id=disqus_thread></div> <script>
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'codeloveandboards'; // required: replace example with your forum shortname
  
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script> <noscript> Please enable JavaScript to view the <a href='//disqus.com/?ref_noscript'>comments powered by Disqus.</a> </noscript> <a class=dsq-brlink href='//disqus.com'> comments powered by <span class=logo-disqus>Disqus</span> </a> </article> </section> </div> </section> <footer id=main_footer> <ul class=article-nav> <li class=previous> <a href="/blog/2013/04/06/automatiza-tu-manera-de-usar-git-con-git-flow/"><h4>previous post</h4> <h3> Automatiza tu manera de usar git con git-flow </h3> <div class=meta-data> <hr> posted Apr 6, 2013 on code, git </div> </a> </li> <li class=next> <a href="/blog/2013/05/19/simulando-enumeradores-en-nuestros-modelos/"><h4>next post</h4> <h3> Simulando enumeradores en nuestros modelos </h3> <div class=meta-data> <hr> posted May 19, 2013 on rails, models </div> </a> </li> </ul> <section> <div class=container> <div class=center> <ul> <li> <a href='/blog'>Archives</a> </li> <li> <a href='//feeds.feedburner.com/CodeLoveAndBoards' target=_blank>RSS</a> </li> </ul> Copyright © 2019 - Ricardo García Vega - Code, Love & Boards! </div> </div> </section> </footer> <script src="../../../../../javascripts/blog-7993bef0.js"></script> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
  ga('create', 'UA-37802122-1', 'codeloveandboards.com');
  ga('send', 'pageview');
</script> <script>
  _StatHat.push(["_trackCount", "g2pcD9xou7DlR0DtndiwvSBBYU5k", 1.0]);
</script> </body> </html>