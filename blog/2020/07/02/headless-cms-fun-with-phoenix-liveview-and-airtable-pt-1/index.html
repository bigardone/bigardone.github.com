<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang=en-us><![endif]--> <!--[if IE 7]><html class="no-js lt-ie10 lt-ie9 lt-ie8" lang=en-us><![endif]--> <!--[if IE 8]><html class="no-js lt-ie10 lt-ie9" lang=en-us><![endif]--> <!--[if IE 9]><html class="no-js lt-ie10 lt-ie9" lang=en-us><![endif]--> <!--[if lt IE 10]><html class="no-js lt-ie10" lang=en-us><![endif]--> <!--[if !IE]>><![endif]--> <html class=no-js lang=en> <head> <title>Headless CMS fun with Phoenix LiveView and Airtable (pt. 1) - Code, Love & Boards</title> <meta charset=utf-8 content='text/html' http-equiv=content-type> <meta content='ie=edge,chrome=1' http-equiv=x-ua-compatible> <meta content='Building a headless CMS around Phoenix LiveView and Airtable.' name=description> <meta content='Ricardo García Vega - http://twitter.com/bigardone' name=author> <meta content='elixir, phoenix, liveview' name=keywords> <meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name=viewport> <link href='//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css' rel=stylesheet> <link href="//fonts.googleapis.com/css?family=Montserrat:400,700|Lora:400,700" media=screen rel=stylesheet /> <link href="../../../../../stylesheets/blog-82c14d7c.css" media=all rel=stylesheet /> <link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css' rel=stylesheet> <script src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js'></script> <script src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/elixir.min.js'></script> <script src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/elm.min.js'></script> <link href='/images/apple-touch-icon-57x57-6e598dc4.png' rel=apple-touch-icon sizes=57x57> <link href='/images/apple-touch-icon-114x114-5be964ba.png' rel=apple-touch-icon sizes=114x114> <link href='/images/apple-touch-icon-72x72-70084a85.png' rel=apple-touch-icon sizes=72x72> <link href='/images/apple-touch-icon-144x144-1dbb56c1.png' rel=apple-touch-icon sizes=144x144> <link href='/images/apple-touch-icon-60x60-d05a5ea9.png' rel=apple-touch-icon sizes=60x60> <link href='/images/apple-touch-icon-120x120-5dafce59.png' rel=apple-touch-icon sizes=120x120> <link href='/images/apple-touch-icon-76x76-b2c0d784.png' rel=apple-touch-icon sizes=76x76> <link href='/images/apple-touch-icon-152x152-45595360.png' rel=apple-touch-icon sizes=152x152> <link href='/images/favicon-160x160-944ce76e.png' rel=icon sizes=160x160 type='image/png'> <link href='/images/favicon-96x96-b7e4e089.png' rel=icon sizes=96x96 type='image/png'> <link href='/images/favicon-32x32-b7f34a79.png' rel=icon sizes=32x32 type='image/png'> <link href='/images/favicon-16x16-2712c528.png' rel=icon sizes=16x16 type='image/png'> <meta content='#9f00a7' name=msapplication-TileColor> <meta content='/images/mstile-144x144-028d4c4c.png' name=msapplication-TileImage> <script>
  var _StatHat = _StatHat || [];
  _StatHat.push(['_setUser', 'NzIzMCDaNaL5bvEP1HQkMYwfYsQe']);
  (function() {
          var sh = document.createElement('script'); sh.type = 'text/javascript';
          sh.async = true;
          sh.src = '//www.stathat.com/javascripts/api.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(sh, s);
  })();
</script> <link href='//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css' rel=stylesheet> <script src='//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js'></script> <script>
  window.addEventListener("load", function(){
  window.cookieconsent.initialise({
    "palette": {
      "popup": {
        "background": "#252e39"
      },
      "button": {
        "background": "#217dbb"
      }
    },
    "theme": "classic",
    "position": "bottom-right"
  })});
</script> </head> <body class=blog> <header id=main_header> <div class=main-logo> <a href="/"><img src="../../../../../images/logo-cd52bd68.png"/> </a> </div> <div class=container> <section class=center> <h1>Headless CMS fun with Phoenix LiveView and Airtable (pt. 1)</h1> <h3></h3> <div class=meta-data> <hr> posted Jul 2, 2020 on <a class=tag href="/blog/tags/elixir.html">elixir</a> <a class=tag href="/blog/tags/phoenix.html">phoenix</a> <a class=tag href="/blog/tags/liveview.html">liveview</a> </div> </section> </div> </header> <section id=main_content> <div class=container> <section> <article> <div class=index> <p>This post belongs to the <strong>Headless CMS fun with Phoenix LiveView and Airtable</strong> series.</p> <ol> <li><a href="/blog/2020/07/02/headless-cms-fun-with-phoenix-liveview-and-airtable-pt-1">Introduction</a></li> <li>Coming soon...</li> </ol> <a href="https://github.com/bigardone/passwordless-auth" target=_blank><i class="fa fa-github"></i> Source code</a> </div> <p>Last year, I built a static website for a friend of mine who has an Italian restaurant, which has been vital for her business since then. The first year the site performed really well businesswise. However, issues have started to appear as my friend needed to change the site&#39;s content to showcase the new season products, menu, and schedule. I started implementing the changes by hand, but we suddenly realized that this was not convenient at all, since she needed to change the content on the fly without having to rely on me. After considering many different possibilities, I solved the problem by implementing a simple solution in a single weekend, thanks to <a href="https://www.phoenixframework.org/">Phoenix</a> and <a href="https://airtable.com/">Airtable</a>. Here&#39;s who I did it.</p> <h2>Introduction</h2> <p>In this new tutorial, we are going to be building a headless content management system consisting of two main elements, which are an Airtable base and a Phoenix application powered by LiveView. Let&#39;s take a more in-depth look at them:</p> <h3>Airtable</h3> <p>Airtable is a really cool service based on spreadsheets grouped in bases, that act as a database. Using a very intuitive and friendly UI, it lets you design your own data structures, add attachments, handle relationships between different tables, design different data views for your tables, and much more. It also exposes all the data through a very convenient API, which is crucial for this tutorial.</p> <p>But why do we need such a service? The main reason is that we want to externalize the content of our website and the management of it by our users, letting us focus only on building the presentation layer, which is a simple Phoenix application. And Airtable is perfect for that.</p> <p><a href="https://airtable.com/shribMafJ0mAR7nic/tblLCFjonKFPr4yiN/viwgxDq0PyWSRs8N4?blocks=hide">Here you can find the base</a> that the we are using for this tutorial, which consists of two tables:</p> <h4>The contents table</h4> <p><img class=center src="/images/blog/phoenix-cms-1/airtable-1-1b70f14e.png"/></p> <p>This table stores the sections of the main page. Its structure is straightforward, structuring the data with the following fields:</p> <ul> <li><code>id</code>: the ID of the section.</li> <li><code>position</code>: An auto-increment number that specifies the order of the section within the page.</li> <li><code>type</code>: the type of the section, which can have three different values: <ul> <li><code>hero</code>: for a hero section containing a big title and subtitle.</li> <li><code>text_and_image</code>: for sections that have some text and an image.</li> <li><code>feature</code>: for a section that has a list of items with some text and an icon.</li> </ul></li> <li><code>title</code>: the title of the section.</li> <li><code>content</code>: the main content of the section. It can store HTML.</li> <li><code>image</code>: the main image of the section. Stored as an attachment.</li> <li><code>styles</code>: any additional styles that we want to add to the section.</li> </ul> <h4>The articles table</h4> <p><img class=center src="/images/blog/phoenix-cms-1/airtable-2-7cfa59a5.png"/></p> <p>This table stores all the blog articles of our website, and each article consists of the following attributes:</p> <ul> <li><code>slug</code>: the SEO friendly slug for the article.</li> <li><code>title</code>: the main title of the article.</li> <li><code>description</code>: the article&#39;s excerpt.</li> <li><code>image</code>: the main image of the article. Stored as an attachment.</li> <li><code>content</code>: the main content of the article. It can store HTML.</li> <li><code>author</code>: the email of the article&#39;s author.</li> <li><code>published_at</code>: the publication date of the article.</li> </ul> <h3>The Phoenix application</h3> <p>The presentation layer of our CMS is a Phoenix application which supervision tree looks something like this:</p> <p><img class=center src="/images/blog/phoenix-cms-1/app-diagram-8fcfdf65.svg"/></p> <p>Let&#39;s have a closer look at some of its components.</p> <h4>Cache</h4> <p>Airtable has a limit of five requests per second for free accounts, so we can&#39;t just send requests on every page visit, because if we have a lot of users, the API is likely going to start returning rate limit errors. Using Erlang&#39;s <a href="https://erlang.org/doc/man/ets.html">ETS</a> to store successful responses from the API helps to prevent rate limiting issues. Once a page is mounted, the data is taken from the cache instead of performing an HTTP request. However, this is not enough, because we need to keep the cache data synced with the latest changes in Airtable.</p> <h4>Synchronizer</h4> <p>To keep the cache data in sync with Airtable, it spawns a <a href="https://hexdocs.pm/elixir/GenServer.html">GenServer</a> process, which periodically makes requests to the API every second, updating its stored data if needed and broadcasting the new data to the live views using <a href="https://hexdocs.pm/phoenix_pubsub/Phoenix.PubSub.html">PubSub</a>. This way, we limit the number of interactions with the API to two requests per second, no matter the number of users are currently visiting our site.</p> <h4>LiveView</h4> <p>Instead of using regular views and templates, the application takes advantage of Phoenix <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveView.html">LiveView</a>, subscribing to specific PubSub topics, updating its data when needed, and refreshing its content on the browser without requiring a reload from the user.</p> <p>Here you can see the three views that it has:</p> <p><img class=center src="/images/blog/phoenix-cms-1/site-9d4bf02d.jpg"/></p> <ol> <li>A main landing page that renders the sections stored in the contents table. These sections are the main hero section, some image and text sections, and a feature list section.</li> <li>A blog page, listing all the articles stored in the articles table.</li> <li>An article detail page that renders a complete article.</li> </ol> <p>And I think this is all for the introduction. In the next part, we will start building the Phoenix application and implementing an HTTP client to retrieve the data stored in Airtable. In the meantime, you can check the end result <a href="https://phoenixcms.herokuapp.com/">here</a>, or have a look at the <a href="https://github.com/bigardone/phoenix-cms">source code</a>.</p> <p>Happy coding!</p> <div class=btn-wrapper> <a href="https://phoenixcms.herokuapp.com/" target=_blank class=btn><i class="fa fa-cloud"></i> Live demo</a> <a href="https://github.com/bigardone/phoenix-cms" target=_blank class=btn><i class="fa fa-github"></i> Source code</a> </div> <div id=disqus_thread></div> <script>
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'codeloveandboards'; // required: replace example with your forum shortname
  
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script> <noscript> Please enable JavaScript to view the <a href='//disqus.com/?ref_noscript'>comments powered by Disqus.</a> </noscript> <a class=dsq-brlink href='//disqus.com'> comments powered by <span class=logo-disqus>Disqus</span> </a> </article> </section> </div> </section> <footer id=main_footer> <ul class=article-nav> <li class=previous> <a href="/blog/2020/04/27/elmcsspatterns-io/"><h4>previous post</h4> <h3> elmcsspatterns.io </h3> <div class=meta-data> <hr> posted Apr 27, 2020 on elm </div> </a> </li> <li class=next> </li> </ul> <section> <div class=container> <div class=center> <ul> <li> <a href='/blog'>Archives</a> </li> <li> <a href='//feeds.feedburner.com/CodeLoveAndBoards' target=_blank>RSS</a> </li> </ul> Copyright © 2020 - Ricardo García Vega - Code, Love & Boards! </div> </div> </section> </footer> <script src="../../../../../javascripts/blog-5ddb0520.js"></script> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
  ga('create', 'UA-37802122-1', 'codeloveandboards.com');
  ga('send', 'pageview');
</script> <script>
  _StatHat.push(["_trackCount", "g2pcD9xou7DlR0DtndiwvSBBYU5k", 1.0]);
</script> </body> </html>