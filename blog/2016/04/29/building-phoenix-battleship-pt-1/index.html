<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang=en-us><![endif]--> <!--[if IE 7]><html class="no-js lt-ie10 lt-ie9 lt-ie8" lang=en-us><![endif]--> <!--[if IE 8]><html class="no-js lt-ie10 lt-ie9" lang=en-us><![endif]--> <!--[if IE 9]><html class="no-js lt-ie10 lt-ie9" lang=en-us><![endif]--> <!--[if lt IE 10]><html class="no-js lt-ie10" lang=en-us><![endif]--> <!--[if !IE]>><![endif]--> <html class=no-js lang=en> <head> <title>Building Phoenix Battleship (pt. 1) - Code, Love & Boards</title> <meta charset=utf-8 content='text/html' http-equiv=content-type> <meta content='ie=edge,chrome=1' http-equiv=x-ua-compatible> <meta content='Designing the game mechanics' name=description> <meta content='Ricardo García Vega - http://twitter.com/bigardone' name=author> <meta content='elixir, phoenix, otp' name=keywords> <meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name=viewport> <link href='//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css' rel=stylesheet> <link href="//fonts.googleapis.com/css?family=Montserrat:400,700|Lora:400,700" media=screen rel=stylesheet /> <link href="../../../../../stylesheets/blog-ed6b1e0f.css" media=all rel=stylesheet /> <link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/tomorrow.min.css' rel=stylesheet> <script src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js'></script> <link href='/images/apple-touch-icon-57x57-6e598dc4.png' rel=apple-touch-icon sizes=57x57> <link href='/images/apple-touch-icon-114x114-5be964ba.png' rel=apple-touch-icon sizes=114x114> <link href='/images/apple-touch-icon-72x72-70084a85.png' rel=apple-touch-icon sizes=72x72> <link href='/images/apple-touch-icon-144x144-1dbb56c1.png' rel=apple-touch-icon sizes=144x144> <link href='/images/apple-touch-icon-60x60-d05a5ea9.png' rel=apple-touch-icon sizes=60x60> <link href='/images/apple-touch-icon-120x120-5dafce59.png' rel=apple-touch-icon sizes=120x120> <link href='/images/apple-touch-icon-76x76-b2c0d784.png' rel=apple-touch-icon sizes=76x76> <link href='/images/apple-touch-icon-152x152-45595360.png' rel=apple-touch-icon sizes=152x152> <link href='/images/favicon-160x160-944ce76e.png' rel=icon sizes=160x160 type='image/png'> <link href='/images/favicon-96x96-b7e4e089.png' rel=icon sizes=96x96 type='image/png'> <link href='/images/favicon-32x32-b7f34a79.png' rel=icon sizes=32x32 type='image/png'> <link href='/images/favicon-16x16-2712c528.png' rel=icon sizes=16x16 type='image/png'> <meta content='#9f00a7' name=msapplication-TileColor> <meta content='/images/mstile-144x144-028d4c4c.png' name=msapplication-TileImage> <script>
  var _StatHat = _StatHat || [];
  _StatHat.push(['_setUser', 'NzIzMCDaNaL5bvEP1HQkMYwfYsQe']);
  (function() {
          var sh = document.createElement('script'); sh.type = 'text/javascript';
          sh.async = true;
          sh.src = '//www.stathat.com/javascripts/api.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(sh, s);
  })();
</script> <link href='//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css' rel=stylesheet> <script src='//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js'></script> <script>
  window.addEventListener("load", function(){
  window.cookieconsent.initialise({
    "palette": {
      "popup": {
        "background": "#252e39"
      },
      "button": {
        "background": "#217dbb"
      }
    },
    "theme": "classic",
    "position": "bottom-right"
  })});
</script> </head> <body class=blog> <header id=main_header> <div class=main-logo> <a href="/"><img src="../../../../../images/logo-cd52bd68.png"/> </a> </div> <div class=container> <section class=center> <h1>Building Phoenix Battleship (pt. 1)</h1> <h3></h3> <div class=meta-data> <hr> posted Apr 29, 2016 on <a class=tag href="/blog/tags/elixir.html">elixir</a> <a class=tag href="/blog/tags/phoenix.html">phoenix</a> <a class=tag href="/blog/tags/otp.html">otp</a> </div> </section> </div> </header> <section id=main_content> <div class=container> <section> <article> <div class=index> <p>This post belongs to the <strong>Building Phoenix Battleship</strong> series.</p> <ol> <li><a href="/blog/2016/04/29/building-phoenix-battleship-pt-1">Designing the game mechanics</a></li> <li><a href="/blog/2016/05/03/building-phoenix-battleship-pt-2/">The lobby channel and game supervision</a></li> <li><a href="/blog/2016/05/21/building-phoenix-battleship-pt-3/">The game setup</a></li> <li><a href="/blog/2016/07/28/building-phoenix-battleship-pt-4/">Placing ships on the board's grid</a></li> <li><a href="/blog/2016/08/08/building-phoenix-battleship-pt-5/">Let the battle begin!</a></li> <li>Coming soon...</li> </ol> </div> <h2>Designing the game mechanics</h2> <p>After cloning <a title="Phoenix Trello" href="https://github.com/bigardone/phoenix-trello">Trello</a> and <a title="Phoenix Toggl" href="https://github.com/bigardone/phoenix-toggl">Toggl</a> I wanted to try something completely different for my next side-project on <strong>Elixir</strong> and <strong>Phoenix</strong>. Therefore, after reading more and more about <strong>OTP</strong>, <strong>GenServer</strong>, <strong>Agent</strong> and <strong>GenEvent</strong> I was so excited about all these new elements to me, that I wanted to build a project where I could put all of them to work together. I also wanted to create something fun with a strong real-time touch, so I ended up knowing that I had to build some kind of multiplayer game. And what better game than the Good Old <a title="Battleship Game" href="https://en.wikipedia.org/wiki/Battleship_(game)">Battleship game</a>?</p> <h3>The puzzle pieces</h3> <p>I draw a lot of diagrams since I started working with <strong>Elixir</strong>. Before coding a single line of code I like taking some time to think about what I want to do and what elements are going to be involved in terms of processes and messages. Once I have an overall idea, I start drawing some sketches representing all that communication flow. I have personally found this very helpful, once you have every element clear in terms of what role is it going to take and how it will communicate with the other system components, coding it is definitely much easier. So after taking some time I finally ended up sketching something similar to the following diagram:</p> <p><img class=center src="/images/blog/building_phoenix_battleship/diagram-44819c48.jpg"/></p> <p>Before continuing any further I&#39;d like to say that for this tutorial series we are not going to dig too much into the front-end, which is very similar to the <strong>Trello</strong> clone. In other words, it&#39;s based on the same <strong>React</strong> and <strong>Redux</strong> implementation with some subtle changes. I&#39;ve also started learning <a title=Elm href="//elm-lang.org/">Elm</a>, so I will probably try to refactor all the front-end and write another tutorial about it... with some luck :)</p> <p>Having this said, let&#39;s take a closer look at the involved components:</p> <h4>The LobbyChannel</h4> <p>A default <a title="Phoenix Channel" href="https://hexdocs.pm/phoenix/Phoenix.Channel.html">Phoenix Channel</a>. Users will join it when visiting the game&#39;s main page. It will be in charge of broadcasting updates of the existing games, and it will also create new games with the help of the <strong>Game.Supervisor</strong>.</p> <h4>The Game.Supervisor</h4> <p>This module will use the <a title="Supervisor behaviour" href="//elixir-lang.org/docs/stable/elixir/Supervisor.html">Supervisor</a> behaviour. It will be responsible for creating new <strong>Game</strong> processes and supervising them, as well as for returning the list of the current games that are actually taking place.</p> <h4>The Game</h4> <p>Will use the <a title="GenServer behaviour" href="//elixir-lang.org/docs/stable/elixir/GenServer.html">GenServer</a>. This processes, supervised by the <strong>Game.Supervisor</strong>, will store the state for a given game. The state will consist of a map containing the ids for both the attacker player and the defender, their <strong>GameChannel pids</strong>, the list of shot results, chat messages, etc. It will also monitor <strong>GameChannel</strong> and <strong>Game.Board</strong> processes, to detect any error and stop the game.</p> <h4>The GameChannel</h4> <p>Another <a title="Phoenix Channel" href="https://hexdocs.pm/phoenix/Phoenix.Channel.html">Phoenix Channel</a>. The main interface between the player&#39;s browser and the <strong>Game</strong> process. It will handle things like joining an existing game, placing ships in the grid, chat messages, shooting, etc. Monitored by a <strong>Game</strong> process so in case the channel&#39;s process ends, the game process ends as well.</p> <h4>The Game.Board</h4> <p>This module will define the basic structure of a player&#39;s board. It will internally use <a title=Agent href="//elixir-lang.org/docs/stable/elixir/Agent.html">Agent</a> for managing a player&#39;s board state. Its state will store the list of ships, the grid map, hit points, etc. It will also have additional functionality related to placing ships and taking shots.</p> <h4>The Game.Event</h4> <p>This module will be added as a worker to the main application supervision tree. It will start a new <a title=GenEvent href="//elixir-lang.org/docs/stable/elixir/GenEvent.html">GenEvent</a> manager and set up its event handlers.</p> <h4>The Game.EventHandler</h4> <p>This module will use <a title=GenEvent href="//elixir-lang.org/docs/stable/elixir/GenEvent.html">GenEvent</a> to handle event messages from the previous <strong>Game.Event</strong> manager and, thanks to the <strong>LobbyChannel</strong>, broadcast every current game change to any connected visitor&#39;s browser.</p> <p>Despite having represented all these different elements, we actually don&#39;t need them all to build a simple game like this. But implementing them will give us the chance to learn some useful concepts related to <strong>OTP</strong>, the differences between <strong>GenServer</strong> and <strong>Agent</strong>, monitoring processes and creating event handlers. I have really enjoyed building it and putting all the pieces together, so I hope you enjoy it too. Therefore, on the next part of this series we&#39;ll start digging deepereer into them. Meanwhile, feel free to take a look to the final (but still in progress, though) source code or challenge a friend to a <a title="Phoenix Battleship" href="https://phoenix-battleship.herokuapp.com/">battleship game</a>... Yo ho ho, let the battle begin!</p> <p>Happy coding!</p> <p><a href="https://phoenix-battleship.herokuapp.com/" target=_blank> <img class=center src="/images/blog/building_phoenix_battleship/lobby-b855456c.jpg"/> </a></p> <div class=btn-wrapper> <a href="https://phoenix-battleship.herokuapp.com/" target=_blank class=btn><i class="fa fa-cloud"></i> Live demo</a> <a href="https://github.com/bigardone/phoenix-battleship" target=_blank class=btn><i class="fa fa-github"></i> Source code</a> </div> <div id=disqus_thread></div> <script>
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'codeloveandboards'; // required: replace example with your forum shortname
  
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script> <noscript> Please enable JavaScript to view the <a href='//disqus.com/?ref_noscript'>comments powered by Disqus.</a> </noscript> <a class=dsq-brlink href='//disqus.com'> comments powered by <span class=logo-disqus>Disqus</span> </a> </article> </section> </div> </section> <footer id=main_footer> <ul class=article-nav> <li class=previous> <a href="/blog/2016/04/26/page-specific-javascript-in-phoenix-framework-pt-2/"><h4>previous post</h4> <h3> Page specific JavaScript in Phoenix framework (pt.2) </h3> <div class=meta-data> <hr> posted Apr 26, 2016 on elixir, phoenix, javascript, webpack </div> </a> </li> <li class=next> <a href="/blog/2016/05/03/building-phoenix-battleship-pt-2/"><h4>next post</h4> <h3> Building Phoenix Battleship (pt. 2) </h3> <div class=meta-data> <hr> posted May 3, 2016 on elixir, phoenix, otp </div> </a> </li> </ul> <section> <div class=container> <div class=center> <ul> <li> <a href='/blog'>Archives</a> </li> <li> <a href='//feeds.feedburner.com/CodeLoveAndBoards' target=_blank>RSS</a> </li> </ul> Copyright © 2018 - Ricardo García Vega - Code, Love & Boards! </div> </div> </section> </footer> <script src="../../../../../javascripts/blog-5ddb0520.js"></script> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
  ga('create', 'UA-37802122-1', 'codeloveandboards.com');
  ga('send', 'pageview');
</script> <script>
  _StatHat.push(["_trackCount", "g2pcD9xou7DlR0DtndiwvSBBYU5k", 1.0]);
</script> </body> </html>