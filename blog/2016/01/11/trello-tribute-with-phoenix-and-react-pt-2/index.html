<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang=en-us><![endif]--> <!--[if IE 7]><html class="no-js lt-ie10 lt-ie9 lt-ie8" lang=en-us><![endif]--> <!--[if IE 8]><html class="no-js lt-ie10 lt-ie9" lang=en-us><![endif]--> <!--[if IE 9]><html class="no-js lt-ie10 lt-ie9" lang=en-us><![endif]--> <!--[if lt IE 10]><html class="no-js lt-ie10" lang=en-us><![endif]--> <!--[if !IE]>><![endif]--> <html class=no-js lang=en> <head> <title>Trello tribute with Phoenix and React (pt.2) - Code, Love & Boards</title> <meta charset=utf-8 content='text/html' http-equiv=content-type> <meta content='ie=edge,chrome=1' http-equiv=x-ua-compatible> <meta content='Phoenix Framework project setup for creating a Trello clone.' name=description> <meta content='Ricardo García Vega - http://twitter.com/bigardone' name=author> <meta content='elixir, phoenix, react, webpack, redux' name=keywords> <meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name=viewport> <link href='//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css' rel=stylesheet> <link href="//fonts.googleapis.com/css?family=Montserrat:400,700|Lora:400,700" media=screen rel=stylesheet /> <link href="../../../../../stylesheets/blog-ed6b1e0f.css" media=all rel=stylesheet /> <link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/tomorrow.min.css' rel=stylesheet> <script src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js'></script> <link href='/images/apple-touch-icon-57x57-6e598dc4.png' rel=apple-touch-icon sizes=57x57> <link href='/images/apple-touch-icon-114x114-5be964ba.png' rel=apple-touch-icon sizes=114x114> <link href='/images/apple-touch-icon-72x72-70084a85.png' rel=apple-touch-icon sizes=72x72> <link href='/images/apple-touch-icon-144x144-1dbb56c1.png' rel=apple-touch-icon sizes=144x144> <link href='/images/apple-touch-icon-60x60-d05a5ea9.png' rel=apple-touch-icon sizes=60x60> <link href='/images/apple-touch-icon-120x120-5dafce59.png' rel=apple-touch-icon sizes=120x120> <link href='/images/apple-touch-icon-76x76-b2c0d784.png' rel=apple-touch-icon sizes=76x76> <link href='/images/apple-touch-icon-152x152-45595360.png' rel=apple-touch-icon sizes=152x152> <link href='/images/favicon-160x160-944ce76e.png' rel=icon sizes=160x160 type='image/png'> <link href='/images/favicon-96x96-b7e4e089.png' rel=icon sizes=96x96 type='image/png'> <link href='/images/favicon-32x32-b7f34a79.png' rel=icon sizes=32x32 type='image/png'> <link href='/images/favicon-16x16-2712c528.png' rel=icon sizes=16x16 type='image/png'> <meta content='#9f00a7' name=msapplication-TileColor> <meta content='/images/mstile-144x144-028d4c4c.png' name=msapplication-TileImage> <script>
  var _StatHat = _StatHat || [];
  _StatHat.push(['_setUser', 'NzIzMCDaNaL5bvEP1HQkMYwfYsQe']);
  (function() {
          var sh = document.createElement('script'); sh.type = 'text/javascript';
          sh.async = true;
          sh.src = '//www.stathat.com/javascripts/api.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(sh, s);
  })();
</script> <link href='https://blog.diacode.com/trello-clone-with-phoenix-and-react-pt-2' rel=canonical> </head> <body class=blog> <header id=main_header> <div class=main-logo> <a href="/"><img src="../../../../../images/logo-cd52bd68.png"/> </a> </div> <div class=container> <section class=center> <h1>Trello tribute with Phoenix and React (pt.2)</h1> <h3></h3> <div class=meta-data> <hr> posted Jan 11, 2016 on <a class=tag href="/blog/tags/elixir.html">elixir</a> <a class=tag href="/blog/tags/phoenix.html">phoenix</a> <a class=tag href="/blog/tags/react.html">react</a> <a class=tag href="/blog/tags/webpack.html">webpack</a> <a class=tag href="/blog/tags/redux.html">redux</a> </div> </section> </div> </header> <section id=main_content> <div class=container> <section> <article> <div class=index> <p>This post belongs to the <strong>Trello tribute with Phoenix Framework and React</strong> series.</p> <ol> <li><a href="/blog/2016/01/04/trello-tribute-with-phoenix-and-react-pt-1">Intro and selected stack</a></li> <li><a href="/blog/2016/01/11/trello-tribute-with-phoenix-and-react-pt-2">Phoenix Framework project setup</a></li> <li><a href="/blog/2016/01/12/trello-tribute-with-phoenix-and-react-pt-3">The User model and JWT auth</a></li> <li><a href="/blog/2016/01/14/trello-tribute-with-phoenix-and-react-pt-4/">Front-end for sign up with React and Redux</a></li> <li><a href="/blog/2016/01/18/trello-tribute-with-phoenix-and-react-pt-5/">Database seeding and sign in controller</a></li> <li><a href="/blog/2016/01/20/trello-tribute-with-phoenix-and-react-pt-6/">Front-end authentication with React and Redux</a></li> <li><a href="/blog/2016/01/25/trello-tribute-with-phoenix-and-react-pt-7/">Sockets and channels</a></li> <li><a href="/blog/2016/01/28/trello-tribute-with-phoenix-and-react-pt-8/">Listing and creating boards</a></li> <li><a href="/blog/2016/02/04/trello-tribute-with-phoenix-and-react-pt-9/">Adding new board members</a></li> <li><a href="/blog/2016/02/15/trello-tribute-with-phoenix-and-react-pt-10/">Tracking connected board members</a></li> <li><a href="/blog/2016/02/24/trello-tribute-with-phoenix-and-react-pt-11/">Adding lists and cards</a></li> <li><a href="/blog/2016/03/04/trello-tribute-with-phoenix-and-react-pt-12/">Deploying our application on Heroku</a></li> </ol> <a href="https://phoenix-trello.herokuapp.com/"><i class="fa fa-cloud"></i> Live demo</a> | <a href="https://github.com/bigardone/phoenix-trello"><i class="fa fa-github"></i> Source code</a> </div> <h2>Project setup</h2> <p>So now that we have selected our <a href="/blog/2016/01/04/trello-tribute-with-phoenix-and-react-pt-1">current stack</a> let&#39;s start by creating the new <strong>Phoenix</strong> project. Before doing so we need to have both <strong><a href="//elixir-lang.org/">Elixir</a></strong> and <strong><a href="//www.phoenixframework.org/">Phoenix</a></strong> already installed in our system so check out both official sites for <a href="//www.phoenixframework.org/docs/installation">installation instructions</a>.</p> <h3>Static assets through Webpack</h3> <p>Compared to Ruby on Rails, <strong>Phoenix</strong> doesn&#39;t have its own asset pipeline, instead it uses <strong><a href="//brunch.io/">Brunch</a></strong> as the assets build tool which to me feels more modern and flexible. The cool thing is that you don&#39;t even need to use <strong>Brunch</strong> if you don&#39;t want to, you can also use <strong><a href="https://webpack.github.io">Webpack</a></strong>. As I haven&#39;t tried <strong>Brunch</strong> before so we&#39;re going to use <strong>Webpack</strong> instead.</p> <p>Phoenix has <strong>node.js</strong> as an <a href="//www.phoenixframework.org/docs/installation#section-node-js-5-0-0-">optional dependency</a>, as it&#39;s required by Brunch, however Webpack also requires node.js, so make sure you have node.js installed as well.</p> <p>Let&#39;s create the new Phoenix project without Brunch:</p> <pre><code class="bash">$ mix phoenix.new --no-brunch phoenix_trello
  ...
  ...
  ...
$ cd phoenix_trello
</code></pre> <p>Alright, now we have our new project created with no assets building tool. Let&#39;s create a new <code>package.json</code> file and install <strong>Webpack</strong> as a dev dependency:</p> <pre><code class="bash">$ npm init
  ... (You can just hit enter when prompted for setting default values.)
  ...
  ...
$ npm i webpack --save-dev
</code></pre> <p>Now our <code>package.json</code> should look something similar to this:</p> <pre><code class="json">{
  &quot;name&quot;: &quot;phoenix_trello&quot;,
  &quot;devDependencies&quot;: {
    &quot;webpack&quot;: &quot;^1.12.9&quot;
  },
  &quot;dependencies&quot;: {
    ...
    &quot;phoenix&quot;: &quot;file:deps/phoenix&quot;,
    &quot;phoenix_html&quot;: &quot;file:deps/phoenix_html&quot;,
    ...
  },
}
</code></pre> <p>We are going to need a bunch of dependencies in the project so instead of listing them all please take a look to the <a href="https://github.com/bigardone/phoenix-trello/blob/master/package.json">source file</a> in the project&#39;s repository to copy and paste them into the <code>package.json</code> file. Now we have to run the following command to install all the packages:</p> <pre><code class="bash">$ npm install
</code></pre> <p>We also need to add a <code>webpack.config.js</code> configuration file to tell <strong>Webpack</strong> how to build the assets:</p> <pre><code class="javascript">&#39;use strict&#39;;

var path = require(&#39;path&#39;);
var ExtractTextPlugin = require(&#39;extract-text-webpack-plugin&#39;);
var webpack = require(&#39;webpack&#39;);

function join(dest) { return path.resolve(__dirname, dest); }

function web(dest) { return join(&#39;web/static/&#39; + dest); }

var config = module.exports = {
  entry: {
    application: [
      web(&#39;css/application.sass&#39;),
      web(&#39;js/application.js&#39;),
    ],
  },

  output: {
    path: join(&#39;priv/static&#39;),
    filename: &#39;js/application.js&#39;,
  },

  resolve: {
    extensions: [&#39;&#39;, &#39;.js&#39;, &#39;.sass&#39;],
    modulesDirectories: [&#39;node_modules&#39;],
  },

  module: {
    noParse: /vendor\/phoenix/,
    loaders: [
      {
        test: /\.js$/,
        exclude: /node_modules/,
        loader: &#39;babel&#39;,
        query: {
          cacheDirectory: true,
          plugins: [&#39;transform-decorators-legacy&#39;],
          presets: [&#39;react&#39;, &#39;es2015&#39;, &#39;stage-2&#39;, &#39;stage-0&#39;],
        },
      },
      {
        test: /\.sass$/,
        loader: ExtractTextPlugin.extract(&#39;style&#39;, &#39;css!sass?indentedSyntax&amp;includePaths[]=&#39; + __dirname +  &#39;/node_modules&#39;),
      },
    ],
  },

  plugins: [
    new ExtractTextPlugin(&#39;css/application.css&#39;),
  ],
};

if (process.env.NODE_ENV === &#39;production&#39;) {
  config.plugins.push(
    new webpack.optimize.DedupePlugin(),
    new webpack.optimize.UglifyJsPlugin({ minimize: true })
  );
}

</code></pre> <p>Here we specify we want two different <a href="https://webpack.github.io/docs/multiple-entry-points.html">webpack entries</a>, one for the JavaScript and the other one for stylesheets, both placed inside the <code>web/static</code> folder. Our output files are going to be created in the <code>private/static</code> folder. As we are going to use some <strong>ES6/7</strong> and <strong>JSX</strong> features we will use <strong>Babel</strong> with some presets designed for this.</p> <p>The final step is to tell <strong>Phoenix</strong> to start <strong>Webpack</strong> every time we start our development server, so it watches our changes while we are developing and generates the resulting asset files that the main view layout is going to reference. To do so we have to add a watcher in the <code>config/dev.exs</code> file:</p> <pre><code class="elixir"># config/dev.exs

config :phoenix_trello, PhoenixTrello.Endpoint,
  http: [port: 4000],
  debug_errors: true,
  code_reloader: true,
  cache_static_lookup: false,
  check_origin: false,
  watchers: [
    node: [&quot;node_modules/webpack/bin/webpack.js&quot;, &quot;--watch&quot;, &quot;--color&quot;, cd: Path.expand(&quot;../&quot;, __DIR__)]
  ]

...
</code></pre> <p>If we now start our development server we can see that <strong>Webpack</strong> is also running and watching:</p> <pre><code class="bash">$ mix phoenix.server
[info] Running PhoenixTrello.Endpoint with Cowboy using http on port 4000
Hash: 93bc1d4743159d9afc35
Version: webpack 1.12.10
Time: 6488ms
              Asset     Size  Chunks             Chunk Names
  js/application.js  1.28 MB       0  [emitted]  application
css/application.css  49.3 kB       0  [emitted]  application
   [0] multi application 40 bytes {0} [built]
    + 397 hidden modules
Child extract-text-webpack-plugin:
        + 2 hidden modules
</code></pre> <h3>Front-end basic structure</h3> <p>Now that we have everything ready to start coding, let&#39;s begin by creating our front-end app structure which is going the need the following <strong>npm</strong> packages among others:</p> <ul> <li><strong>bourbon</strong> and <strong>bourbon-neat</strong>, my all time favorite Sass mixin library.</li> <li><strong>history</strong> to manage history with JavaScript.</li> <li><strong>react</strong> and <strong>react-dom</strong>.</li> <li><strong>redux</strong> and <strong>react-redux</strong> for handling the state.</li> <li><strong>react-router</strong> as routing library.</li> <li><strong>redux-simple-router</strong> to keep route changes in the state.</li> </ul> <p>I&#39;m not going to waste any time on talking about stylesheets as I&#39;m still modifying them at this moment but what I&#39;d like to mention is that for creating a suitable file structure to organize my <strong>Sass</strong> files I usually follow <a href="//css-burrito.com/">css-burrito</a>, which in my personal opinion is very useful.</p> <p>We need to configure our <strong>Redux</strong> store so let&#39;s create the following file:</p> <pre><code class="javascript">//web/static/js/store/index.js

import { createStore, applyMiddleware } from &#39;redux&#39;;
import { routerMiddleware }             from &#39;react-router-redux&#39;;
import createLogger                     from &#39;redux-logger&#39;;
import thunkMiddleware                  from &#39;redux-thunk&#39;;
import reducers                         from &#39;../reducers&#39;;

const loggerMiddleware = createLogger({
  level: &#39;info&#39;,
  collapsed: true,
});

export default function configureStore(browserHistory) {
  const reduxRouterMiddleware = routerMiddleware(browserHistory)
  const createStoreWithMiddleware = applyMiddleware(reduxRouterMiddleware, thunkMiddleware, loggerMiddleware)(createStore);

  return createStoreWithMiddleware(reducers);
}
</code></pre> <p>Basically we are configuring the <strong>Store</strong> with three middlewares:</p> <ul> <li><strong>routerMiddleware</strong> to dispatch router actions to the store.</li> <li><strong>redux-thunk</strong> to dispatch async actions.</li> <li><strong>redux-logger</strong> to log any action and state changes through the browser&#39;s console.</li> </ul> <p>We also need to pass all the combined state reducers, so let&#39;s create a basic version of that file:</p> <pre><code class="javascript">//web/static/js/reducers/index.js

import { combineReducers }  from &#39;redux&#39;;
import { routerReducer }    from &#39;react-router-redux&#39;;
import session              from &#39;./session&#39;;

export default combineReducers({
  routing: routeReducer,
  session: session,
});
</code></pre> <p>As starting point we are only going to need two reducers, the <code>routeReducer</code> which will automatically set routing changes into the state and a <code>session</code> reducer which looks like this:</p> <pre><code class="javascript">//web/static/js/reducers/session.js

const initialState = {
  currentUser: null,
  socket: null,
  error: null,
};

export default function reducer(state = initialState, action = {}) {
  return state;
}
</code></pre> <p>Its initial state will consists of the <code>currentUser</code> object which we will set after authenticating visitors, the <code>sockect</code> that we will use for connecting to channels and an <code>error</code> to keep track of any issue while authenticating the user.</p> <p>Having all this prepared now we can go to our main <code>application.js</code> file and render de <code>Root</code> component:</p> <pre><code class="javascript">//web/static/js/application.js

import React                    from &#39;react&#39;;
import ReactDOM                 from &#39;react-dom&#39;;
import { browserHistory }       from &#39;react-router&#39;;
import { syncHistoryWithStore } from &#39;react-router-redux&#39;;
import configureStore           from &#39;./store&#39;;
import Root                     from &#39;./containers/root&#39;;

const store = configureStore(browserHistory);
const history = syncHistoryWithStore(browserHistory, store);

const target = document.getElementById(&#39;main_container&#39;);
const node = &lt;Root routerHistory={history} store={store} /&gt;;

ReactDOM.render(node, target);
</code></pre> <p>We create the history, configure the store we finally render the <code>Root</code> component in the main application layout which will be a <strong>Redux</strong> <code>Provider</code> wrapper for the <code>routes</code>:</p> <pre><code class="javascript">//web/static/js/containers/root.js

import React, { PropTypes }         from &#39;react&#39;;
import { Provider }                 from &#39;react-redux&#39;;
import { Router, RoutingContext }   from &#39;react-router&#39;;
import invariant                    from &#39;invariant&#39;;
import configRoutes                 from &#39;../routes&#39;;

const propTypes = {
  routerHistory: PropTypes.object.isRequired,
  store: PropTypes.object.isRequired
};

const Root = ({ routerHistory, store }) =&gt; {
  invariant(
    routerHistory,
    &#39;&lt;Root /&gt; needs either a routingContext or routerHistory to render.&#39;
  );

  return (
    &lt;Provider store={store}&gt;
      &lt;Router history={routerHistory}&gt;
        {configRoutes(store)}
      &lt;/Router&gt;
    &lt;/Provider&gt;
  );
};

Root.propTypes = propTypes;
export default Root;
</code></pre> <p>Now let&#39;s define our, very basic, routes file:</p> <pre><code class="javascript">//web/static/js/routes/index.js

import { IndexRoute, Route }  from &#39;react-router&#39;;
import React                  from &#39;react&#39;;
import MainLayout             from &#39;../layouts/main&#39;;
import RegistrationsNew       from &#39;../views/registrations/new&#39;;

export default (
  &lt;Route component={MainLayout}&gt;
    &lt;Route path=&quot;/&quot; component={RegistrationsNew} /&gt;
  &lt;/Route&gt;
);
</code></pre> <p>Our application is going to be wrapped inside the <code>MainLayout</code> component and the root path will render the registrations view. The final version of this file is a bit more complex due to the authentication mechanism we&#39;ll be implementing, but we&#39;ll talk about it on the next post.</p> <p>Finally we need to add the html container where we&#39;ll render the <code>Root</code> component in the main <strong>Phoenix</strong> application layout:</p> <pre><code class="html">&lt;!-- web/templates/layout/app.html.eex --&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
    &lt;meta name=&quot;description&quot; content=&quot;&quot;&gt;
    &lt;meta name=&quot;author&quot; content=&quot;ricardo@codeloveandboards.com&quot;&gt;

    &lt;title&gt;Phoenix Trello&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;&lt;%= static_path(@conn, &quot;/css/application.css&quot;) %&gt;&quot;&gt;
  &lt;/head&gt;

  &lt;body&gt;
    &lt;main id=&quot;main_container&quot; role=&quot;main&quot;&gt;&lt;/main&gt;
    &lt;script src=&quot;&lt;%= static_path(@conn, &quot;/js/application.js&quot;) %&gt;&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre> <p>Note both the link and the script tags referencing the static assets generated by <strong>Webpack</strong>.</p> <p>As we are going manage our routing on the front-end, we need to tell <strong>Phoenix</strong> to handle any http request through the <code>index</code> action of the <code>PageController</code> which will just render the main layout and our <code>Root</code> component:</p> <pre><code class="elixir"># master/web/router.ex

defmodule PhoenixTrello.Router do
  use PhoenixTrello.Web, :router

  pipeline :browser do
    plug :accepts, [&quot;html&quot;]
    plug :fetch_session
    plug :fetch_flash
    plug :protect_from_forgery
    plug :put_secure_browser_headers
  end

  scope &quot;/&quot;, PhoenixTrello do
    pipe_through :browser # Use the default browser stack

    get &quot;/*path&quot;, PageController, :index
  end
end
</code></pre> <p>That&#39;s it for now. On the next post we&#39;ll be covering how to create our first database migration, the <code>User</code> model and all the functionality for creating new user accounts. In the meanwhile you can check out the live demo and the final result source code:</p> <div class=btn-wrapper> <a href="https://phoenix-trello.herokuapp.com/" target=_blank class=btn><i class="fa fa-cloud"></i> Live demo</a> <a href="https://github.com/bigardone/phoenix-trello" target=_blank class=btn><i class="fa fa-github"></i> Source code</a> </div> <p>Happy coding!</p> <div id=disqus_thread></div> <script>
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'codeloveandboards'; // required: replace example with your forum shortname
  
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script> <noscript> Please enable JavaScript to view the <a href='//disqus.com/?ref_noscript'>comments powered by Disqus.</a> </noscript> <a class=dsq-brlink href='//disqus.com'> comments powered by <span class=logo-disqus>Disqus</span> </a> </article> </section> </div> </section> <footer id=main_footer> <ul class=article-nav> <li class=previous> <a href="/blog/2016/01/04/trello-tribute-with-phoenix-and-react-pt-1/"><h4>previous post</h4> <h3> Trello tribute with Phoenix and React (pt.1) </h3> <div class=meta-data> <hr> posted Jan 4, 2016 on elixir, phoenix, react </div> </a> </li> <li class=next> <a href="/blog/2016/01/12/trello-tribute-with-phoenix-and-react-pt-3/"><h4>next post</h4> <h3> Trello tribute with Phoenix and React (pt.3) </h3> <div class=meta-data> <hr> posted Jan 12, 2016 on elixir, phoenix, ecto </div> </a> </li> </ul> <section> <div class=container> <div class=center> <ul> <li> <a href='/blog'>Archives</a> </li> <li> <a href='//feeds.feedburner.com/CodeLoveAndBoards' target=_blank>RSS</a> </li> </ul> Copyright © 2018 - Ricardo García Vega - Code, Love & Boards! </div> </div> </section> </footer> <script src="../../../../../javascripts/blog-5ddb0520.js"></script> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
  ga('create', 'UA-37802122-1', 'codeloveandboards.com');
  ga('send', 'pageview');
</script> <script>
  _StatHat.push(["_trackCount", "g2pcD9xou7DlR0DtndiwvSBBYU5k", 1.0]);
</script> </body> </html>